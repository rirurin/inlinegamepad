<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>
            body {
                display: flex;
                flex-direction: row;
                justify-content: flex-end;
                background-color: yellow;
            }
            img {
                width: 50px;
                height: 50px;
            }
        </style>
        <script>
            var activeButtons = [];
            var buttonList = [
                "Cross",
                "Circle",
                "Square",
                "Triangle",
                "L1",
                "R1",
                "L2",
                "R2",
                "Select",
                "Start",
                "L3",
                "R3",
                "DUp",
                "DDown",
                "DLeft",
                "DRight",
            ]
            var pastInputs = [];
            var limit = 25;
            window.addEventListener("gamepadconnected", function(e) {
                let gp = navigator.getGamepads()[0];
                for (i = 0; i < gp.buttons.length; i++) {
                    activeButtons.push(gp.buttons[i].pressed == true ? true : false);
                }
                console.log(activeButtons);
                gameLoop();
            });
            
            function gameLoop() {
                let gp = navigator.getGamepads()[0];
                // console.log(gp.buttons[0].pressed);
                for (i = 0; i < gp.buttons.length; i++) {
                    if (gp.buttons[i].pressed == true && activeButtons[i] == false) {
                        // rising edge
                        console.log(`Button ${buttonList[i]} was pressed`)
                        pastInputs.push(buttonList[i]);
                        if (pastInputs.length > limit) {
                            pastInputs.splice(0, 1);
                        }
                        activeButtons[i] = true;
                        // document.body.innerHTML += buttonList[i]
                    }
                    if (gp.buttons[i].pressed == false && activeButtons[i] == true) {
                        // falling edge
                        activeButtons[i] = false;
                    }
                }
                document.body.innerHTML = "";
                for (i = 0; i < pastInputs.length; i++) {
                    var a = document.createElement("img");
                    a.setAttribute("src", `ctrl${pastInputs[i]}.png`)
                    document.body.appendChild(a);
                }
                let start = requestAnimationFrame(gameLoop);
            }
            
        </script>
    </head>
    <body>
        
    </body>
</html>